# main/rules.py

import re


def normalize_text(text: str) -> str:
    """
    –ü—Ä–∏–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –∫ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–º—É –≤–∏–¥—É:
    - —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    - –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    """
    if not text:
        return ""
    text = text.strip()
    text = re.sub(r"\s+", " ", text)
    return text


def should_answer_offtopic(text: str):
    """
    –§–∏–ª—å—Ç—Ä –±–æ–ª—Ç–æ–≤–Ω–∏ –∏ –º—É—Å–æ—Ä–∞.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
      (True, –æ—Ç–≤–µ—Ç)  ‚Äî –µ—Å–ª–∏ –ù–ï –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–ª—å—à–µ
      (False, None)  ‚Äî –µ—Å–ª–∏ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
    """

    t = text.lower().strip()

    # —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ
    if len(t) > 500:
        return True, "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –î–∞–≤–∞–π –±–ª–∏–∂–µ –∫ —Ñ–∏–Ω–∞–Ω—Å–∞–º."

    # —á–∏—Å—Ç—ã–π –º—É—Å–æ—Ä
    if t in ["–∞", "–º–º", "–Ω—É", "–æ–∫", "–∞–≥–∞"]:
        return True, "–Ø –∑–¥–µ—Å—å üôÇ –ì–æ–≤–æ—Ä–∏ –ø–æ –¥–µ–Ω—å–≥–∞–º."

    # —è–≤–Ω—ã–π –æ—Ñ—Ñ—Ç–æ–ø
    off_topics = [
        "–∫–∞–∫ –¥–µ–ª–∞",
        "—á—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å",
        "–∫—Ç–æ —Ç—ã",
        "—Ç—ã –∫—Ç–æ",
        "–ø–æ–≥–æ–≤–æ—Ä–∏–º",
        "—Ä–∞—Å—Å–∫–∞–∂–∏",
        "–∞–Ω–µ–∫–¥–æ—Ç",
        "—à—É—Ç–∫",
        "—Ñ–∏–ª—å–º",
        "–∏–≥—Ä–∞",
        "–ø–æ–ª–∏—Ç",
        "—Ä–µ–ª–∏–≥",
    ]

    for w in off_topics:
        if w in t:
            return True, "–Ø —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞. –î–∞–≤–∞–π –ø–æ –¥–µ–Ω—å–≥–∞–º."

    return False, None

